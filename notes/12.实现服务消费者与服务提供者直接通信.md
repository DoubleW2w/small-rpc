---
title: 12.å®ç°æœåŠ¡æ¶ˆè´¹è€…ä¸æœåŠ¡æä¾›è€…ç›´æ¥é€šä¿¡
date: 2024/6/09
---
## ğŸˆS

æœåŠ¡æ¶ˆè´¹è€…æ˜¯é€šè¿‡åœ¨ã€Œæµ‹è¯•æ¨¡å—ã€æ¨¡æ‹Ÿå‡ºæ¥çš„ï¼Œå¹¶ä¸”å¯åŠ¨æœåŠ¡æ¶ˆè´¹è€…çš„åº•å±‚ Netty ä»£ç ç›´æ¥å†™åœ¨äº†æµ‹è¯•çš„ main()æ–¹æ³•ä¸­ã€‚

## ğŸˆT

> å¦‚ä½•åœ¨ä½¿ç”¨æœåŠ¡æ¶ˆè´¹è€…æ—¶ï¼Œåªéœ€è¦ä¼ é€’å¿…è¦çš„å‚æ•°ï¼Œå°±èƒ½ä¸æœåŠ¡æä¾›è€…é€šä¿¡ï¼

å‚è€ƒæµ‹è¯•ç±»æ–¹æ³•

```java
@Test
public void testConsumerConnectProvider() throws InterruptedException {
    Bootstrap bootstrap = new Bootstrap();
    EventLoopGroup eventLoopGroup = new NioEventLoopGroup(4);
    try {
        bootstrap
            .group(eventLoopGroup)
            .channel(NioSocketChannel.class)
            .handler(new RpcTestConsumerInitializer());
        bootstrap.connect("127.0.0.1", 27880).sync();
    } catch (Exception e) {
        log.error(e.getMessage(), e);
    } finally {
        Thread.sleep(2000);
        eventLoopGroup.shutdownGracefully();
    }
}
```

æˆ‘ä»¬åªè¦çŸ¥é“æœåŠ¡æä¾›è€…è€…çš„ã€Œæ³¨å†Œåœ°å€ã€ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å°±å¯ä»¥å’ŒæœåŠ¡æä¾›è€…è¿›è¡Œé€šä¿¡ã€‚

<img src="https://doublew2w-myblogimages.oss-cn-hangzhou.aliyuncs.com/img/202406091713014.png"/>

## ğŸˆA



<img src="https://doublew2w-myblogimages.oss-cn-hangzhou.aliyuncs.com/img/202406091839329.png"/>

## ğŸˆR

### æµ‹è¯•ç±»

```java
  @Test
  public void testRpcConsumerHandler() throws Exception {
    RpcConsumer consumer = RpcConsumer.getInstance();
    consumer.sendRequest(getRpcRequestProtocol());
    Thread.sleep(2000);
    consumer.close();
  }

  private RpcProtocol<RpcRequest> getRpcRequestProtocol() {
    // æ¨¡æ‹Ÿå‘é€æ•°æ®
    RpcProtocol<RpcRequest> protocol = new RpcProtocol<RpcRequest>();
    protocol.setHeader(RpcHeaderFactory.getRequestHeader("jdk"));
    RpcRequest request = new RpcRequest();
    request.setClassName("com.doublew2w.rpc.test.api.DemoService");
    request.setGroup("double");
    request.setMethodName("hello");
    request.setParameters(new Object[] {"mynadasdasweeqqwwe"});
    request.setParameterTypes(new Class[] {String.class});
    request.setVersion("1.0.0");
    request.setAsync(false);
    request.setOneway(false);
    protocol.setBody(request);
    return protocol;
  }
```

- è·å–æ¶ˆè´¹è€…å®ä¾‹
- æ„é€ æ¶ˆè´¹è€…å‘èµ·è°ƒç”¨çš„è¯·æ±‚ä¿¡æ¯
- å‘èµ·è¯·æ±‚

### å•ä¾‹æ¨¡å¼

```java
  /**
   * åŒé‡æ ¡éªŒé”-å•ä¾‹æ¨¡å¼
   *
   * @return RpcConsumerå®ä¾‹
   */
  public static RpcConsumer getInstance() {
    if (instance == null) {
      synchronized (RpcConsumer.class) {
        if (instance == null) {
          instance = new RpcConsumer();
        }
      }
    }
    return instance;
  }
```

ä½¿ç”¨å•ä¾‹å®ä¾‹åˆ›å»º RpcConsumer å®ä¾‹ï¼Œä¿è¯æœåŠ¡æ¶ˆè´¹è€…åªæœ‰å”¯ä¸€å®ä¾‹ã€‚



### log4j2 å¼€å¯é¢œè‰²

å‚è€ƒé“¾æ¥ï¼š[springboot log4j2é…ç½®å‚è€ƒ-highlight-IDEæ§åˆ¶å°å½©è‰²æ—¥å¿—](https://blog.csdn.net/dixialieren/article/details/106398841)

```xml
        <Console name="console_out_appender" target="SYSTEM_OUT">
            <!-- è¾“å‡ºæ—¥å¿—çš„æ ¼å¼ -->
            <PatternLayout>
                <pattern>${consolePattern}</pattern>
                <disableAnsi>false</disableAnsi>
                <noConsoleNoAnsi>false</noConsoleNoAnsi>
            </PatternLayout>
        </Console>
```

```xml
    <Properties>
        <Property name="log4j.skipJansi" value="false"/>
    </Properties>
```

